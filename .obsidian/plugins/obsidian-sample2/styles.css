/*

This CSS file will be included with your plugin, and
available in the app when your plugin is enabled.

If your plugin does not need CSS, delete this file.

*/

/* 自定义的&nbsp;空格小部件样式 */
.nbsp-space-widget {
  display: inline;
  white-space: pre;
  color: inherit;
  background: inherit;
  cursor: text;
  position: relative;
}

/* 添加一个可选的悬停效果以便用户知道这里有特殊空格 */
.nbsp-space-widget:hover::after {
  content: "·";
  position: absolute;
  left: 0;
  top: -2px;
  color: var(--text-accent);
  opacity: 0.5;
  font-size: 0.8em;
}

/* 确保小部件正确继承编辑器样式 */
.cm-content .nbsp-space-widget {
  font-family: inherit;
  font-size: inherit;
  line-height: inherit;
}

/* 隐藏源码模式下的&nbsp;实体 - 多种选择器结合 */
.markdown-source-view.mod-cm6 .cm-content .cm-line span:has(span:contains("&nbsp;")),
.markdown-source-view.mod-cm6 .cm-content .cm-line span:contains("&nbsp;"),
.cm-editor .cm-line span.cm-string:contains("&nbsp;"),
.cm-editor .cm-line span[data-text*="&nbsp;"],
div[contenteditable=true] span:contains("&nbsp;") {
  opacity: 0.2 !important;
  position: relative;
}

/* CodeMirror 6特定选择器 */
.markdown-source-view.mod-cm6 .cm-content .cm-line .cm-string[data-text*="&nbsp;"],
.markdown-source-view.mod-cm6 .cm-content .cm-line .cm-formatting[data-text*="&nbsp;"],
.markdown-source-view.mod-cm6 .cm-content .cm-line .cm-url[data-text*="&nbsp;"] {
  opacity: 0.3 !important;
}

/* 在源码视图中保护代码块内的&nbsp; */
.cm-hmd-codeblock span:contains("&nbsp;"),
.HyperMD-codeblock span:contains("&nbsp;"),
.cm-inline-code span:contains("&nbsp;"),
pre code span:contains("&nbsp;") {
  opacity: 1 !important;
}

/* 直接修改DOM节点属性 */
[data-nbsp-handled="true"] {
  opacity: 0.1;
  color: var(--text-faint) !important;
}

/* 查找特定行内的匹配 */
.cm-line:has(span:contains("&nbsp;")) {
  position: relative;
}

/* 作为后备，使用全局选择器 */
span[class*="cm-"][data-text*="&nbsp;"],
span[data-value*="&nbsp;"],
span:contains("&nbsp;"):not(.cm-hmd-codeblock *) {
  opacity: 0.2;
}

/* 所有包含&nbsp;的父元素添加标记，便于JavaScript处理 */
.cm-content .cm-line span:contains("&nbsp;")::before {
  content: "";
  position: absolute;
  left: 0;
  top: 0;
  height: 100%;
  width: 3px;
  background-color: var(--text-accent-hover);
  opacity: 0.2;
}

/* 在&nbsp;实体位置显示小圆点指示符 */
.markdown-source-view.mod-cm6 .cm-content .cm-line span[class*="formatting"][data-value="&nbsp;"]:after,
.markdown-source-view.mod-cm6 .cm-content .cm-line span[data-value="&nbsp;"]:after,
.markdown-source-view.mod-cm6 .cm-content .cm-line span:contains("&nbsp;"):after {
  content: "·";
  opacity: 0.6;
  font-size: 0.9em;
  position: absolute;
  top: 0;
  left: 0;
  color: var(--text-muted);
}

/* 鼠标悬停时增加可见度 */
.markdown-source-view.mod-cm6 .cm-content .cm-line span[class*="formatting"][data-value="&nbsp;"]:hover,
.markdown-source-view.mod-cm6 .cm-content .cm-line span[data-value="&nbsp;"]:hover,
.markdown-source-view.mod-cm6 .cm-content .cm-line span:contains("&nbsp;"):hover {
  opacity: 0.4;
}

/* 直接针对CodeMirror中的文本 */
.markdown-source-view.mod-cm6 .cm-line:not(.cm-hmd-frontmatter) {
  --nbsp-color: transparent;
}

/* 强制处理&nbsp;文本 */
.markdown-source-view.mod-cm6 .cm-line:not(.cm-hmd-frontmatter) .cm-string:contains("&nbsp;"),
.markdown-source-view.mod-cm6 .cm-line:not(.cm-hmd-frontmatter) .cm-hmd-internal-link:contains("&nbsp;"),
.markdown-source-view.mod-cm6 .cm-line:not(.cm-hmd-frontmatter) span:contains("&nbsp;") {
  color: var(--nbsp-color, transparent);
  position: relative;
}

/* 直接覆盖CodeMirror内部样式 */
.CodeMirror-line span[title*="&nbsp;"] {
  opacity: 0.1;
}

/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var h=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var m=Object.prototype.hasOwnProperty;var N=(o,n)=>{for(var t in n)h(o,t,{get:n[t],enumerable:!0})},v=(o,n,t,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let e of w(n))!m.call(o,e)&&e!==t&&h(o,e,{get:()=>n[e],enumerable:!(s=f(n,e))||s.enumerable});return o};var C=o=>v(h({},"__esModule",{value:!0}),o);var S={};N(S,{default:()=>l});module.exports=C(S);var i=require("obsidian"),I={hideNbsp:!0,visibleColor:"#000000",hiddenColor:"#ff0000"},l=class extends i.Plugin{constructor(){super(...arguments);this.statusBarItem=null}async onload(){await this.loadSettings(),this.statusBarItem=this.addStatusBarItem(),this.updateStatusBar(),this.addRibbonIcon("eye-off","\u5207\u6362&nbsp;\u53EF\u89C1\u6027",async()=>{this.settings.hideNbsp=!this.settings.hideNbsp,await this.saveSettings(),this.updateStatusBar(),this.updateNbspInEditor(),new i.Notice(`\u975E\u65AD\u884C\u7A7A\u683C\u73B0\u5728${this.settings.hideNbsp?"\u5DF2\u9690\u85CF":"\u53EF\u89C1"}`)}),this.addCommand({id:"toggle-nbsp-visibility",name:"\u5207\u6362&nbsp;\u53EF\u89C1\u6027",callback:async()=>{this.settings.hideNbsp=!this.settings.hideNbsp,await this.saveSettings(),this.updateStatusBar(),this.updateNbspInEditor(),new i.Notice(`\u975E\u65AD\u884C\u7A7A\u683C\u73B0\u5728${this.settings.hideNbsp?"\u5DF2\u9690\u85CF":"\u53EF\u89C1"}`)}}),this.addCommand({id:"replace-nbsp-with-space",name:"\u5C06&nbsp;\u66FF\u6362\u4E3A\u666E\u901A\u7A7A\u683C\uFF08\u6587\u4EF6\u5185\u5BB9\uFF09",editorCallback:(t,s)=>{let p=t.getValue().replace(/&nbsp;/g," ");t.setValue(p),new i.Notice("\u5DF2\u5C06\u6240\u6709&nbsp;\u66FF\u6362\u4E3A\u666E\u901A\u7A7A\u683C\uFF0C\u6587\u4EF6\u5185\u5BB9\u5DF2\u4FEE\u6539")}}),this.addCommand({id:"refresh-nbsp-display",name:"\u5F3A\u5236\u5237\u65B0&nbsp;\u663E\u793A",callback:()=>{this.updateNbspInEditor(!0),new i.Notice("\u5DF2\u5237\u65B0&nbsp;\u663E\u793A")}}),this.addCommand({id:"force-show-nbsp",name:"\u5F3A\u5236\u663E\u793A\u6240\u6709&nbsp;",callback:async()=>{this.settings.hideNbsp=!1,await this.saveSettings(),this.updateStatusBar(),this.updateNbspInEditor(!0),new i.Notice("\u5DF2\u5F3A\u5236\u663E\u793A\u6240\u6709\u975E\u65AD\u884C\u7A7A\u683C")}}),this.addSettingTab(new u(this.app,this)),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.handleActiveLeafChange()})),this.registerEvent(this.app.workspace.on("file-open",()=>{this.handleFileOpen()})),this.handleActiveLeafChange()}updateStatusBar(){this.statusBarItem?(this.statusBarItem.setText(""),this.statusBarItem.setText("NBSP: "+(this.settings.hideNbsp?"\u5DF2\u9690\u85CF":"\u53EF\u89C1")),this.settings.hideNbsp?(this.statusBarItem.addClass("nbsp-hidden-status"),this.statusBarItem.removeClass("nbsp-visible-status")):(this.statusBarItem.addClass("nbsp-visible-status"),this.statusBarItem.removeClass("nbsp-hidden-status"))):(this.statusBarItem=this.addStatusBarItem(),this.statusBarItem.setText("NBSP: "+(this.settings.hideNbsp?"\u5DF2\u9690\u85CF":"\u53EF\u89C1")))}isInSourceMode(t){let s=t||this.app.workspace.getActiveViewOfType(i.MarkdownView);return s?s.getMode()==="source":!1}handleActiveLeafChange(){let t=this.app.workspace.getActiveViewOfType(i.MarkdownView);t&&this.isInSourceMode(t)&&this.updateNbspInEditor()}handleFileOpen(){let t=this.app.workspace.getActiveViewOfType(i.MarkdownView);t&&this.isInSourceMode(t)&&this.updateNbspInEditor()}updateNbspInEditor(t=!1){let s=this.app.workspace.getActiveViewOfType(i.MarkdownView);if(!s||!this.isInSourceMode(s))return;let e=s.editor;if(!e)return;let p=e.getValue();if(!p.includes("&nbsp;")&&!p.includes('class="nbsp-replacement"')&&!p.includes('<font color="')&&!t)return;let c=e.getCursor(),r=e.getScrollInfo(),a=p,d=/<span class="nbsp-replacement" title="Non-breaking space">&nbsp;<\/span>/g;a=a.replace(d,"&nbsp;");let g=/<font color="#[0-9a-fA-F]{6}">&nbsp;<\/font>/g;if(a=a.replace(g,"&nbsp;"),this.settings.hideNbsp){let b=/&nbsp;/g;a=a.replace(b,`<font color="${this.settings.hiddenColor}">&nbsp;</font>`)}a!==p&&(e.setValue(a),e.setCursor(c),e.scrollTo(r.left,r.top))}onunload(){let t=this.app.workspace.getActiveViewOfType(i.MarkdownView);if(t&&this.isInSourceMode(t)){let s=t.editor;if(s){let e=s.getValue(),p=/<font color="#[0-9a-fA-F]{6}">&nbsp;<\/font>/g,c=/<span class="nbsp-replacement" title="Non-breaking space">&nbsp;<\/span>/g,r=e;if(r=r.replace(p,"&nbsp;"),r=r.replace(c,"&nbsp;"),r!==e){let a=s.getCursor(),d=s.getScrollInfo();s.setValue(r),s.setCursor(a),s.scrollTo(d.left,d.top)}}}}async loadSettings(){this.settings=Object.assign({},I,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.updateStatusBar(),this.updateNbspInEditor(!0)}};var u=class extends i.PluginSettingTab{constructor(t,s){super(t,s);this.plugin=s}display(){let{containerEl:t}=this;t.empty(),new i.Setting(t).setName("\u9690\u85CF\u6E90\u7801\u6A21\u5F0F\u4E0B\u7684&nbsp;").setDesc("\u542F\u7528\u540E\uFF0C\u5728\u6E90\u7801\u6A21\u5F0F\u4E0B\u5C06&nbsp;\u5B9E\u4F53\u66FF\u6362\u4E3A\u7EA2\u8272\u5B57\u4F53\uFF1B\u7981\u7528\u65F6\u6062\u590D\u4E3A\u666E\u901A&nbsp;").addToggle(s=>s.setValue(this.plugin.settings.hideNbsp).onChange(async e=>{this.plugin.settings.hideNbsp=e,await this.plugin.saveSettings(),this.plugin.updateStatusBar()})),new i.Setting(t).setName("\u9690\u85CF\u72B6\u6001\u989C\u8272").setDesc("\u8BBE\u7F6E&nbsp;\u5728\u9690\u85CF\u72B6\u6001\u4E0B\u7684\u989C\u8272\uFF08\u9ED8\u8BA4\u4E3A\u7EA2\u8272 #ff0000\uFF09").addText(s=>s.setValue(this.plugin.settings.hiddenColor).onChange(async e=>{/^#[0-9a-fA-F]{6}$/.test(e)?(this.plugin.settings.hiddenColor=e,await this.plugin.saveSettings()):new i.Notice("\u8BF7\u8F93\u5165\u6709\u6548\u7684\u5341\u516D\u8FDB\u5236\u989C\u8272\u503C\uFF0C\u4F8B\u5982 #ff0000")})),t.createEl("div",{text:"\u8BF4\u660E\uFF1A\u672C\u63D2\u4EF6\u5728\u9690\u85CF\u6A21\u5F0F\u4E0B\u5C06&nbsp;\u66FF\u6362\u4E3A\u5E26\u989C\u8272\u7684\u5B57\u4F53\u6807\u7B7E\uFF0C\u5728\u53EF\u89C1\u6A21\u5F0F\u4E0B\u6062\u590D\u4E3A\u666E\u901A&nbsp;\u3002"}).addClass("setting-item-description"),t.createEl("div",{text:"\u989C\u8272\u503C\u5FC5\u987B\u662F\u6709\u6548\u7684\u5341\u516D\u8FDB\u5236\u683C\u5F0F\uFF0C\u4F8B\u5982 #ff0000\uFF08\u7EA2\u8272\uFF09\u3002"}).addClass("setting-item-description"),t.createEl("div",{text:'\u5982\u679C\u9700\u8981\u6C38\u4E45\u5C06\u6587\u4EF6\u4E2D\u7684&nbsp;\u66FF\u6362\u4E3A\u666E\u901A\u7A7A\u683C\uFF0C\u8BF7\u4F7F\u7528\u547D\u4EE4\u9762\u677F\u4E2D\u7684"\u5C06&nbsp;\u66FF\u6362\u4E3A\u666E\u901A\u7A7A\u683C"\u547D\u4EE4\u3002'}).addClass("setting-item-description")}};

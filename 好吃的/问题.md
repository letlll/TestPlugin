@/obsidian-sample-plugin-master 现在是一个obsidian的插件示例sample我需要你去阅读代码，并且熟悉代码，我将要开发一个点击md的![[avatar.jpg]]进行使用windows默认的图片查看器进行查看，请你对于点击的事件进行分析是点击md源码，和渲染的图片都可以进行查看。


---

你希望开发一个 Obsidian 插件，实现如下功能：

在编辑（源码）模式下，点击 `![[avatar.jpg]]` 这样的图片引用，可以用 Windows 默认图片查看器打开图片。
在预览（渲染）模式下，点击图片同样可以用 Windows 默认图片查看器打开图片。

你还希望我先熟悉 sample 插件的代码结构，并对“点击事件”如何实现这两个场景进行分析。

### 1. 代码结构简要分析

sample 插件的核心文件是 `main.ts`，它演示了如何注册命令、设置项、全局事件等。主要用到的 API 有：

- `this.registerDomEvent(document, 'click', ...)` 注册全局 DOM 事件。
- `this.app.workspace.getActiveViewOfType(MarkdownView)` 获取当前激活的 Markdown 视图。
- `MarkdownView.getMode()` 可以判断当前是编辑模式还是预览模式。

### 2. 现有图片外部打开插件的实现方式

你提供的 `opener/main.js` 插件，已经实现了“在预览区双击图片时用系统查看器打开图片”。它的做法是：

- 监听 `document` 的 `dblclick` 事件。
- 判断事件目标是否为图片嵌入（`internal-embed image-embed`）。
- 获取图片的 src，查找 vault 内部图片的绝对路径。
- 用 `shell.openPath(absPath)` 打开图片。

### 3. 你的需求分析

#### 3.1 预览模式

- 监听图片的点击事件（可以用 click 或 dblclick）。
- 判断目标是否为图片（`internal-embed image-embed` 或 `<img>`）。
- 获取图片路径，转换为绝对路径。
- 用 `shell.openPath(absPath)` 打开。

这部分和 `opener/main.js` 的实现类似，只是事件类型可以用 click/dblclick。

#### 3.2 编辑（源码）模式

- 编辑模式下，`![[avatar.jpg]]` 是一段文本，不是图片。
- 需要监听编辑器的点击事件，判断点击位置是否在 `![[xxx]]` 语法上。
- 如果是，获取 `xxx` 的文件名，查找 vault 内部图片的绝对路径。
- 用 `shell.openPath(absPath)` 打开。

技术实现上，可以通过监听编辑器的 `mousedown` 或 `click` 事件，结合光标位置和文本内容判断。

### 4. 事件监听点建议

- 预览模式：监听 `document` 上的 click/dblclick，判断 target 是否为图片。
- 编辑模式：监听编辑器（CodeMirror）的 click/mousedown，判断点击位置是否在 `![[xxx]]` 上。

### 5. 结论

- 预览模式的图片点击可参考 `opener/main.js`，只需调整事件类型和触发方式。
- 编辑模式需要结合编辑器 API，判断点击位置是否在图片引用语法上，并实现文件查找与打开。

如果你需要，我可以帮你详细设计和实现这两个场景的代码。请告诉我你希望先做哪一部分，或者需要完整的实现方案？